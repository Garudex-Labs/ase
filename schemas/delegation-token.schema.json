{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ase-protocol.org/schemas/delegation-token.schema.json",
  "title": "Delegation Token",
  "description": "JWT-based delegation token for hierarchical agent authorization with spending limits and operation restrictions",
  "type": "object",
  "required": ["header", "payload", "signature"],
  "properties": {
    "header": {
      "type": "object",
      "description": "JWT header with algorithm and key identifier",
      "required": ["alg", "typ"],
      "properties": {
        "alg": {
          "type": "string",
          "description": "Cryptographic signing algorithm",
          "enum": ["ES256", "RS256"],
          "examples": ["ES256", "RS256"]
        },
        "typ": {
          "type": "string",
          "description": "Token type",
          "const": "JWT"
        },
        "kid": {
          "type": "string",
          "description": "Key identifier for signature verification",
          "minLength": 1,
          "maxLength": 255
        }
      },
      "additionalProperties": false
    },
    "payload": {
      "type": "object",
      "description": "JWT payload with standard and ASE-specific claims",
      "required": ["iss", "sub", "aud", "exp", "iat", "jti", "spendingLimit"],
      "properties": {
        "iss": {
          "type": "string",
          "description": "Issuer - delegating agent ID",
          "minLength": 1,
          "maxLength": 255
        },
        "sub": {
          "type": "string",
          "description": "Subject - delegated agent ID",
          "minLength": 1,
          "maxLength": 255
        },
        "aud": {
          "type": "string",
          "description": "Audience - target service or 'any' for unrestricted",
          "minLength": 1,
          "maxLength": 255
        },
        "exp": {
          "type": "integer",
          "description": "Expiration time (Unix timestamp in seconds)",
          "minimum": 0
        },
        "iat": {
          "type": "integer",
          "description": "Issued at time (Unix timestamp in seconds)",
          "minimum": 0
        },
        "jti": {
          "type": "string",
          "description": "Unique token identifier (JWT ID)",
          "minLength": 1,
          "maxLength": 255
        },
        "spendingLimit": {
          "$ref": "monetary-amount.schema.json#",
          "description": "Maximum spending allowed with this token"
        },
        "allowedOperations": {
          "type": "array",
          "description": "List of permitted operations (empty array means all operations allowed)",
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 255
          },
          "uniqueItems": true
        },
        "maxDelegationDepth": {
          "type": "integer",
          "description": "Maximum depth for further delegations (0 means no further delegation allowed)",
          "minimum": 0,
          "maximum": 5,
          "default": 0
        },
        "budgetCategory": {
          "type": "string",
          "description": "Budget category for tracking and reporting",
          "minLength": 1,
          "maxLength": 255
        },
        "parentTokenId": {
          "type": "string",
          "description": "Optional parent token ID for hierarchical delegation tracking",
          "minLength": 1,
          "maxLength": 255
        },
        "delegationChain": {
          "type": "array",
          "description": "Optional chain of delegation token IDs from root to current",
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 255
          },
          "maxItems": 5
        }
      },
      "additionalProperties": false
    },
    "signature": {
      "type": "string",
      "description": "Base64url-encoded cryptographic signature",
      "pattern": "^[A-Za-z0-9_-]+$"
    }
  },
  "additionalProperties": false
}
